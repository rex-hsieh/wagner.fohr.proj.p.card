png("acct_dept_expenses/acct_codes_counts_plot.png", width = 800, height = 600, units = 'px', res=110)
op <- par(mar=c(6,4,4,2))
ylim <- c(0, 1.3*max(final_counts_acct_codes$Frequency))
acct_codes_counts_plot <- barplot(final_counts_acct_codes$Frequency, names.arg = row.names(final_counts_acct_codes),
horiz = FALSE,las=2,main = "P-Card Counts by Account Codes",
ylim = ylim, col="light blue")
rm(op)
text(x = acct_codes_counts_plot, y = final_counts_acct_codes$Frequency,
label = final_counts_acct_codes$Frequency, pos = 3, cex = 0.8, col = "blue")
dev.off()
op <- par(mar=c(6,3,3,2))
ylim <- c(0, 1.3*max(net_sum$Total))
net_sum_last_name_plot <- barplot(net_sum$Total,names.arg = row.names(net_sum),
horiz = FALSE,las=2,main = "P-Card Spending by Cardholder",
ylim=ylim, col="light blue")
op <- par(mar=c(6,1,3,2))
ylim <- c(0, 1.3*max(net_sum$Total))
net_sum_last_name_plot <- barplot(net_sum$Total,names.arg = row.names(net_sum),
horiz = FALSE,las=2,main = "P-Card Spending by Cardholder",
ylim=ylim, col="light blue")
op <- par(mar=c(5,2,3,2))
ylim <- c(0, 1.3*max(net_sum$Total))
net_sum_last_name_plot <- barplot(net_sum$Total,names.arg = row.names(net_sum),
horiz = FALSE,las=2,main = "P-Card Spending by Cardholder",
ylim=ylim, col="light blue")
rm(op)
op <- par(mar=c(5,4,3,2))
ylim <- c(0, 1.3*max(net_sum$Total))
net_sum_last_name_plot <- barplot(net_sum$Total,names.arg = row.names(net_sum),
horiz = FALSE,las=2,main = "P-Card Spending by Cardholder",
ylim=ylim, col="light blue")
op <- par(mar=c(5,4,2,2))
ylim <- c(0, 1.3*max(net_sum$Total))
net_sum_last_name_plot <- barplot(net_sum$Total,names.arg = row.names(net_sum),
horiz = FALSE,las=2,main = "P-Card Spending by Cardholder",
ylim=ylim, col="light blue")
rm(op)
op <- par(mar=c(2,4,2,2))
ylim <- c(0, 1.3*max(net_sum$Total))
net_sum_last_name_plot <- barplot(net_sum$Total,names.arg = row.names(net_sum),
horiz = FALSE,las=2,main = "P-Card Spending by Cardholder",
ylim=ylim, col="light blue")
op <- par(mar=c(7,4,2,2))
ylim <- c(0, 1.3*max(net_sum$Total))
net_sum_last_name_plot <- barplot(net_sum$Total,names.arg = row.names(net_sum),
horiz = FALSE,las=2,main = "P-Card Spending by Cardholder",
ylim=ylim, col="light blue")
rm(op)
op <- par(mar=c(9,4,2,2))
ylim <- c(0, 1.3*max(net_sum$Total))
net_sum_last_name_plot <- barplot(net_sum$Total,names.arg = row.names(net_sum),
horiz = FALSE,las=2,main = "P-Card Spending by Cardholder",
ylim=ylim, col="light blue")
rm(op)
op <- par(mar=c(9,4,1,2))
ylim <- c(0, 1.3*max(net_sum$Total))
net_sum_last_name_plot <- barplot(net_sum$Total,names.arg = row.names(net_sum),
horiz = FALSE,las=2,main = "P-Card Spending by Cardholder",
ylim=ylim, col="light blue")
rm(op)
op <- par(mar=c(9,5,2,2))
ylim <- c(0, 1.3*max(net_sum$Total))
net_sum_last_name_plot <- barplot(net_sum$Total,names.arg = row.names(net_sum),
horiz = FALSE,las=2,main = "P-Card Spending by Cardholder",
ylim=ylim, col="light blue")
rm(op)
op <- par(mar=c(9,4,2,2))
ylim <- c(0, 1.3*max(net_sum$Total))
net_sum_last_name_plot <- barplot(net_sum$Total,names.arg = row.names(net_sum),
horiz = FALSE,las=2,main = "P-Card Spending by Cardholder",
ylim=ylim, col="light blue")
rm(op)
text(x = net_sum_last_name_plot, y = net_sum$Total,
label = net_sum$Total, pos = 3,
srt = 30, cex = 0.8, col = "blue")
dev.off()
op <- par(mar=c(9,4,2,2))
ylim <- c(0, 1.3*max(net_sum$Total))
net_sum_last_name_plot <- barplot(net_sum$Total,names.arg = row.names(net_sum),
horiz = FALSE,las=2,main = "P-Card Spending by Cardholder",
ylim=ylim, col="light blue")
rm(op)
text(x = net_sum_last_name_plot, y = net_sum$Total,
label = net_sum$Total, pos = 3,
srt = 30, cex = 0.8, col = "blue")
op <- par(mar=c(9,4,2,2))
ylim <- c(0, 1.3*max(net_sum$Total))
net_sum_last_name_plot <- barplot(net_sum$Total,names.arg = row.names(net_sum),
horiz = FALSE,las=2,main = "P-Card Spending by Cardholder",
ylim=ylim, col="light blue")
rm(op)
text(x = net_sum_last_name_plot, y = net_sum$Total,
label = net_sum$Total, pos = 3,
srt = 30, cex = 0.8, col = "blue")
net_sum_last_name_plot <- barplot(net_sum$Total,names.arg = row.names(net_sum),
horiz = FALSE,las=2,main = "P-Card Spending by Cardholder",
ylim=ylim, col="light blue")
png("acct_dept_expenses/last_names_net_sum_plot.png", width = 800, height = 600, units = 'px', res=110)
op <- par(mar=c(9,4,2,2))
ylim <- c(0, 1.3*max(net_sum$Total))
net_sum_last_name_plot <- barplot(net_sum$Total,names.arg = row.names(net_sum),
horiz = FALSE,las=2,main = "P-Card Spending by Cardholder",
ylim=ylim, col="light blue")
rm(op)
text(x = net_sum_last_name_plot, y = net_sum$Total,
label = net_sum$Total, pos = 3,
srt = 30, cex = 0.8, col = "blue")
dev.off()
list.of.packages <- c("readr", "tictoc", "lubridate")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
library(tictoc)
tic("Everything")
rm(list=ls())
setwd("~/P card reporting project")
library(readr)
data <- read.csv("cta_card_data.csv")
data$FIN.TRANSACTION.AMOUNT <- parse_number(data$FIN.TRANSACTION.AMOUNT)
data$ACC.LAST.NAME <- as.character(data$ACC.LAST.NAME)
(tot_sum <- sum(data$FIN.TRANSACTION.AMOUNT, na.rm = TRUE))
lnames <- unique(data$ACC.LAST.NAME)
(lnames <- as.character(lnames))
spending <- vector("list", length = length(lnames))
# Total spending by unique last names (P-card data for now)--------
net_sum = data.frame(cbind("ln" = lnames, "final" = spending))
final_sum <- c()
for (i in 1:length(lnames)){
new_data <- data[which(data$ACC.LAST.NAME == lnames[i]),]
new_sum <- sum(new_data$FIN.TRANSACTION.AMOUNT)
final_sum[lnames[i]] <- new_sum
}
(net_sum <- data.frame(sort(final_sum, decreasing = TRUE) ) )
(colnames(net_sum) <- c("Total"))
(net_sum$"% of Total" <- paste(round( (net_sum$Total / tot_sum) * 100, digits = 2), "%", sep ="") )
png("acct_dept_expenses/last_names_cta_net_sum_plot.png", width = 800, height = 600, units = 'px', res=110)
op <- par(mar=c(6,4,3,2))
ylim <- c(0, 1.2*max(net_sum$Total))
op <- par(mar=c(9,4,4,2))
net_sum_last_name_plot <- barplot(net_sum$Total,names.arg = row.names(net_sum),
horiz = FALSE,las=2,main = "CTA Spending by Cardholder",
ylim=ylim, col="light blue")
rm(op)
text(x = net_sum_last_name_plot, y = net_sum$Total,
label = net_sum$Total, pos = 3,
srt = 30, cex = 0.8, col = "blue")
dev.off()
# Total spending by unique account codes----
data$FIN.ACCOUNTING.CODE.02.VALUE <- as.character(data$FIN.ACCOUNTING.CODE.02.VALUE)
(acct_codes <- unique(na.omit(data$FIN.ACCOUNTING.CODE.02.VALUE)) )
final_sum_acct_codes <- c()
for (i in 1:length(acct_codes)){
new_data <- data[data$FIN.ACCOUNTING.CODE.02.VALUE == acct_codes[i],]
new_sum <- sum(new_data$FIN.TRANSACTION.AMOUNT)
final_sum_acct_codes[acct_codes[i]] <- new_sum
}
(net_sum_acct_codes <- data.frame(final_sum_acct_codes) )
(net_sum_acct_codes <- data.frame(sort(final_sum_acct_codes, decreasing = TRUE) ) )
(colnames(net_sum_acct_codes) <- c("Total"))
png("acct_dept_expenses/acct_codes_cta_net_sum_plot.png", width = 800, height = 600, units = 'px', res=110)
op <- par(mar=c(6,4,3,2))
ylim <- c(0, 1.2*max(net_sum_acct_codes$Total))
net_sum_acct_plot <- barplot(net_sum_acct_codes$Total,names.arg = row.names(net_sum_acct_codes),
horiz = FALSE,las=2,main = "CTA Spending by Account Codes",
ylim = ylim, col="light blue") # Data labels, $ amounts
rm(op)
text(x = net_sum_acct_plot, y = net_sum_acct_codes$Total,
label = net_sum_acct_codes$Total, pos = 3,
srt = 30, cex = 0.8, col = "blue")
dev.off()
# Now, by counts of unique account codes----
(net_counts_acct_codes <- table(data$FIN.ACCOUNTING.CODE.02.VALUE))
(net_counts_acct_codes <- as.data.frame(net_counts_acct_codes))
(row.names(net_counts_acct_codes) <- net_counts_acct_codes$Var1)
(net_counts_acct_codes <- subset(net_counts_acct_codes, select = Freq))
final_counts_acct_codes <- c()
for(x in row.names(net_counts_acct_codes)){
final_counts_acct_codes[x] = net_counts_acct_codes[x,]
}
( final_counts_acct_codes <- data.frame(sort(final_counts_acct_codes, decreasing = TRUE)) )
(colnames(final_counts_acct_codes) <- c("Frequency") )
png("acct_dept_expenses/acct_codes_cta_counts_plot.png", width = 800, height = 600, units = 'px', res=110)
op <- par(mar=c(6,4,4,2))
ylim <- c(0, 1.2*max(final_counts_acct_codes$Frequency))
acct_codes_counts_plot <- barplot(final_counts_acct_codes$Frequency, names.arg = row.names(net_counts_acct_codes),
horiz = FALSE,las=2,main = "CTA Counts by Account Codes",
ylim = ylim, col="light blue")
rm(op)
text(x = acct_codes_counts_plot, y = final_counts_acct_codes$Frequency,
label = final_counts_acct_codes$Frequency, pos = 3, cex = 0.8, col = "blue")
dev.off()
# Big account codes table----
acct_codes_table <- data.frame(Final.Count = numeric(), Final.Sum= numeric() )
for(x in acct_codes){
final_count <- final_counts_acct_codes[x,]
final_sum <- net_sum_acct_codes[x,]
acct_codes_table[x,] <- c(final_count,final_sum)
}
(acct_codes_table <- as.data.frame(acct_codes_table) )
write.csv(acct_codes_table, file = "acct_dept_expenses/acct_codes_cta_count_sum_table.csv")
# By department codes----
(net_counts_dept_codes <- table(data$FIN.ACCOUNTING.CODE.04.VALUE))
(net_counts_dept_codes <- as.data.frame(net_counts_dept_codes))
(row.names(net_counts_dept_codes) <- net_counts_dept_codes$Var1)
(net_counts_dept_codes <- subset(net_counts_dept_codes, select = Freq))
final_counts_dept_codes <- c()
for(x in row.names(net_counts_dept_codes)){
final_counts_dept_codes[x] = net_counts_dept_codes[x,]
}
(final_counts_dept_codes <- data.frame(sort(final_counts_dept_codes, decreasing = TRUE)) )
(colnames(final_counts_dept_codes) <- c("Frequency") )
write.csv(final_counts_dept_codes, file = "acct_dept_expenses/dept_codes_cta_count_table.csv")
png("acct_dept_expenses/dept_codes_cta_counts_plot.png", width = 800, height = 600, units = 'px', res=110)
op <- par(mar=c(6,4,4,2))
ylim <- c(0, 1.2*max(final_counts_dept_codes$Frequency))
dept_codes_plot <- barplot(final_counts_dept_codes$Frequency, names.arg = row.names(final_counts_dept_codes),
horiz = FALSE,las=2, ylim = ylim, main = "CTA Counts by Department",
col="light blue")
rm(op)
text(x = dept_codes_plot, y = final_counts_dept_codes$Frequency,
label = final_counts_dept_codes$Frequency, pos = 3, cex = 0.8, col = "blue")
dev.off()
toc()
list.of.packages <- c("readr", "tictoc", "lubridate")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
library(tictoc)
tic("Everything")
rm(list=ls())
setwd("~/P card reporting project")
library(readr)
data <- read.csv("cta_card_data.csv")
data$FIN.TRANSACTION.AMOUNT <- parse_number(data$FIN.TRANSACTION.AMOUNT)
data$ACC.LAST.NAME <- as.character(data$ACC.LAST.NAME)
(tot_sum <- sum(data$FIN.TRANSACTION.AMOUNT, na.rm = TRUE))
lnames <- unique(data$ACC.LAST.NAME)
(lnames <- as.character(lnames))
spending <- vector("list", length = length(lnames))
# Total spending by unique last names (P-card data for now)--------
net_sum = data.frame(cbind("ln" = lnames, "final" = spending))
final_sum <- c()
for (i in 1:length(lnames)){
new_data <- data[which(data$ACC.LAST.NAME == lnames[i]),]
new_sum <- sum(new_data$FIN.TRANSACTION.AMOUNT)
final_sum[lnames[i]] <- new_sum
}
(net_sum <- data.frame(sort(final_sum, decreasing = TRUE) ) )
(colnames(net_sum) <- c("Total"))
(net_sum$"% of Total" <- paste(round( (net_sum$Total / tot_sum) * 100, digits = 2), "%", sep ="") )
png("acct_dept_expenses/last_names_cta_net_sum_plot.png", width = 800, height = 600, units = 'px', res=110)
op <- par(mar=c(6,4,3,2))
ylim <- c(0, 1.2*max(net_sum$Total))
op <- par(mar=c(9,4,4,2))
net_sum_last_name_plot <- barplot(net_sum$Total,names.arg = row.names(net_sum),
horiz = FALSE,las=2,main = "CTA Spending by Cardholder",
ylim=ylim, col="light blue")
rm(op)
text(x = net_sum_last_name_plot, y = net_sum$Total,
label = net_sum$Total, pos = 3,
srt = 30, cex = 0.8, col = "blue")
dev.off()
# Total spending by unique account codes----
data$FIN.ACCOUNTING.CODE.02.VALUE <- as.character(data$FIN.ACCOUNTING.CODE.02.VALUE)
(acct_codes <- unique(na.omit(data$FIN.ACCOUNTING.CODE.02.VALUE)) )
final_sum_acct_codes <- c()
for (i in 1:length(acct_codes)){
new_data <- data[data$FIN.ACCOUNTING.CODE.02.VALUE == acct_codes[i],]
new_sum <- sum(new_data$FIN.TRANSACTION.AMOUNT)
final_sum_acct_codes[acct_codes[i]] <- new_sum
}
(net_sum_acct_codes <- data.frame(final_sum_acct_codes) )
(net_sum_acct_codes <- data.frame(sort(final_sum_acct_codes, decreasing = TRUE) ) )
(colnames(net_sum_acct_codes) <- c("Total"))
png("acct_dept_expenses/acct_codes_cta_net_sum_plot.png", width = 800, height = 600, units = 'px', res=110)
op <- par(mar=c(6,4,3,2))
ylim <- c(0, 1.2*max(net_sum_acct_codes$Total))
net_sum_acct_plot <- barplot(net_sum_acct_codes$Total,names.arg = row.names(net_sum_acct_codes),
horiz = FALSE,las=2,main = "CTA Spending by Account Codes",
ylim = ylim, col="light blue") # Data labels, $ amounts
rm(op)
text(x = net_sum_acct_plot, y = net_sum_acct_codes$Total,
label = net_sum_acct_codes$Total, pos = 3,
srt = 30, cex = 0.8, col = "blue")
dev.off()
# Now, by counts of unique account codes----
(net_counts_acct_codes <- table(data$FIN.ACCOUNTING.CODE.02.VALUE))
(net_counts_acct_codes <- as.data.frame(net_counts_acct_codes))
(row.names(net_counts_acct_codes) <- net_counts_acct_codes$Var1)
(net_counts_acct_codes <- subset(net_counts_acct_codes, select = Freq))
final_counts_acct_codes <- c()
for(x in row.names(net_counts_acct_codes)){
final_counts_acct_codes[x] = net_counts_acct_codes[x,]
}
( final_counts_acct_codes <- data.frame(sort(final_counts_acct_codes, decreasing = TRUE)) )
(colnames(final_counts_acct_codes) <- c("Frequency") )
png("acct_dept_expenses/acct_codes_cta_counts_plot.png", width = 800, height = 600, units = 'px', res=110)
op <- par(mar=c(6,4,4,2))
ylim <- c(0, 1.2*max(final_counts_acct_codes$Frequency))
acct_codes_counts_plot <- barplot(final_counts_acct_codes$Frequency, names.arg = row.names(net_counts_acct_codes),
horiz = FALSE,las=2,main = "CTA Counts by Account Codes",
ylim = ylim, col="light blue")
rm(op)
text(x = acct_codes_counts_plot, y = final_counts_acct_codes$Frequency,
label = final_counts_acct_codes$Frequency, pos = 3, cex = 0.8, col = "blue")
dev.off()
# Big account codes table----
acct_codes_table <- data.frame(Final.Count = numeric(), Final.Sum= numeric() )
for(x in acct_codes){
final_count <- final_counts_acct_codes[x,]
final_sum <- net_sum_acct_codes[x,]
acct_codes_table[x,] <- c(final_count,final_sum)
}
(acct_codes_table <- as.data.frame(acct_codes_table) )
write.csv(acct_codes_table, file = "acct_dept_expenses/acct_codes_cta_count_sum_table.csv")
# By department codes----
(net_counts_dept_codes <- table(data$FIN.ACCOUNTING.CODE.04.VALUE))
(net_counts_dept_codes <- as.data.frame(net_counts_dept_codes))
(row.names(net_counts_dept_codes) <- net_counts_dept_codes$Var1)
(net_counts_dept_codes <- subset(net_counts_dept_codes, select = Freq))
final_counts_dept_codes <- c()
for(x in row.names(net_counts_dept_codes)){
final_counts_dept_codes[x] = net_counts_dept_codes[x,]
}
(final_counts_dept_codes <- data.frame(sort(final_counts_dept_codes, decreasing = TRUE)) )
(colnames(final_counts_dept_codes) <- c("Frequency") )
write.csv(final_counts_dept_codes, file = "acct_dept_expenses/dept_codes_cta_count_table.csv")
png("acct_dept_expenses/dept_codes_cta_counts_plot.png", width = 800, height = 600, units = 'px', res=110)
op <- par(mar=c(6,4,4,2))
ylim <- c(0, 1.2*max(final_counts_dept_codes$Frequency))
dept_codes_plot <- barplot(final_counts_dept_codes$Frequency, names.arg = row.names(final_counts_dept_codes),
horiz = FALSE,las=2, ylim = ylim, main = "CTA Counts by Department",
col="light blue")
rm(op)
text(x = dept_codes_plot, y = final_counts_dept_codes$Frequency,
label = final_counts_dept_codes$Frequency, pos = 3, cex = 0.8, col = "blue")
dev.off()
toc()
list.of.packages <- c("readr", "tictoc", "lubridate")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
library(tictoc)
tic("Everything")
rm(list=ls())
setwd("~/P card reporting project")
library(readr)
data <- read.csv("cta_card_data.csv")
data$FIN.TRANSACTION.AMOUNT <- parse_number(data$FIN.TRANSACTION.AMOUNT)
data$ACC.LAST.NAME <- as.character(data$ACC.LAST.NAME)
(tot_sum <- sum(data$FIN.TRANSACTION.AMOUNT, na.rm = TRUE))
lnames <- unique(data$ACC.LAST.NAME)
(lnames <- as.character(lnames))
spending <- vector("list", length = length(lnames))
# Total spending by unique last names (P-card data for now)--------
net_sum = data.frame(cbind("ln" = lnames, "final" = spending))
final_sum <- c()
for (i in 1:length(lnames)){
new_data <- data[which(data$ACC.LAST.NAME == lnames[i]),]
new_sum <- sum(new_data$FIN.TRANSACTION.AMOUNT)
final_sum[lnames[i]] <- new_sum
}
(net_sum <- data.frame(sort(final_sum, decreasing = TRUE) ) )
(colnames(net_sum) <- c("Total"))
(net_sum$"% of Total" <- paste(round( (net_sum$Total / tot_sum) * 100, digits = 2), "%", sep ="") )
png("acct_dept_expenses/last_names_cta_net_sum_plot.png", width = 800, height = 600, units = 'px', res=110)
op <- par(mar=c(6,4,3,2))
ylim <- c(0, 1.2*max(net_sum$Total))
op <- par(mar=c(9,4,4,2))
net_sum_last_name_plot <- barplot(net_sum$Total,names.arg = row.names(net_sum),
horiz = FALSE,las=2,main = "CTA Spending by Cardholder",
ylim=ylim, col="light blue")
rm(op)
text(x = net_sum_last_name_plot, y = net_sum$Total,
label = net_sum$Total, pos = 3,
srt = 30, cex = 0.8, col = "blue")
dev.off()
# Total spending by unique account codes----
data$FIN.ACCOUNTING.CODE.02.VALUE <- as.character(data$FIN.ACCOUNTING.CODE.02.VALUE)
(acct_codes <- unique(na.omit(data$FIN.ACCOUNTING.CODE.02.VALUE)) )
final_sum_acct_codes <- c()
for (i in 1:length(acct_codes)){
new_data <- data[data$FIN.ACCOUNTING.CODE.02.VALUE == acct_codes[i],]
new_sum <- sum(new_data$FIN.TRANSACTION.AMOUNT)
final_sum_acct_codes[acct_codes[i]] <- new_sum
}
(net_sum_acct_codes <- data.frame(final_sum_acct_codes) )
(net_sum_acct_codes <- data.frame(sort(final_sum_acct_codes, decreasing = TRUE) ) )
(colnames(net_sum_acct_codes) <- c("Total"))
png("acct_dept_expenses/acct_codes_cta_net_sum_plot.png", width = 800, height = 600, units = 'px', res=110)
op <- par(mar=c(6,4,3,2))
ylim <- c(0, 1.2*max(net_sum_acct_codes$Total))
net_sum_acct_plot <- barplot(net_sum_acct_codes$Total,names.arg = row.names(net_sum_acct_codes),
horiz = FALSE,las=2,main = "CTA Spending by Account Codes",
ylim = ylim, col="light blue") # Data labels, $ amounts
rm(op)
text(x = net_sum_acct_plot, y = net_sum_acct_codes$Total,
label = net_sum_acct_codes$Total, pos = 3,
srt = 30, cex = 0.8, col = "blue")
dev.off()
# Now, by counts of unique account codes----
(net_counts_acct_codes <- table(data$FIN.ACCOUNTING.CODE.02.VALUE))
(net_counts_acct_codes <- as.data.frame(net_counts_acct_codes))
(row.names(net_counts_acct_codes) <- net_counts_acct_codes$Var1)
(net_counts_acct_codes <- subset(net_counts_acct_codes, select = Freq))
final_counts_acct_codes <- c()
for(x in row.names(net_counts_acct_codes)){
final_counts_acct_codes[x] = net_counts_acct_codes[x,]
}
( final_counts_acct_codes <- data.frame(sort(final_counts_acct_codes, decreasing = TRUE)) )
(colnames(final_counts_acct_codes) <- c("Frequency") )
png("acct_dept_expenses/acct_codes_cta_counts_plot.png", width = 800, height = 600, units = 'px', res=110)
op <- par(mar=c(6,4,4,2))
ylim <- c(0, 1.2*max(final_counts_acct_codes$Frequency))
acct_codes_counts_plot <- barplot(final_counts_acct_codes$Frequency, names.arg = row.names(net_counts_acct_codes),
horiz = FALSE,las=2,main = "CTA Counts by Account Codes",
ylim = ylim, col="light blue")
rm(op)
text(x = acct_codes_counts_plot, y = final_counts_acct_codes$Frequency,
label = final_counts_acct_codes$Frequency, pos = 3, cex = 0.8, col = "blue")
dev.off()
# Big account codes table----
acct_codes_table <- data.frame(Final.Count = numeric(), Final.Sum= numeric() )
for(x in acct_codes){
final_count <- final_counts_acct_codes[x,]
final_sum <- net_sum_acct_codes[x,]
acct_codes_table[x,] <- c(final_count,final_sum)
}
(acct_codes_table <- as.data.frame(acct_codes_table) )
write.csv(acct_codes_table, file = "acct_dept_expenses/acct_codes_cta_count_sum_table.csv")
# By department codes----
(net_counts_dept_codes <- table(data$FIN.ACCOUNTING.CODE.04.VALUE))
(net_counts_dept_codes <- as.data.frame(net_counts_dept_codes))
(row.names(net_counts_dept_codes) <- net_counts_dept_codes$Var1)
(net_counts_dept_codes <- subset(net_counts_dept_codes, select = Freq))
final_counts_dept_codes <- c()
for(x in row.names(net_counts_dept_codes)){
final_counts_dept_codes[x] = net_counts_dept_codes[x,]
}
(final_counts_dept_codes <- data.frame(sort(final_counts_dept_codes, decreasing = TRUE)) )
(colnames(final_counts_dept_codes) <- c("Frequency") )
write.csv(final_counts_dept_codes, file = "acct_dept_expenses/dept_codes_cta_count_table.csv")
png("acct_dept_expenses/dept_codes_cta_counts_plot.png", width = 800, height = 600, units = 'px', res=110)
op <- par(mar=c(6,4,4,2))
ylim <- c(0, 1.2*max(final_counts_dept_codes$Frequency))
dept_codes_plot <- barplot(final_counts_dept_codes$Frequency, names.arg = row.names(final_counts_dept_codes),
horiz = FALSE,las=2, ylim = ylim, main = "CTA Counts by Department",
col="light blue")
rm(op)
text(x = dept_codes_plot, y = final_counts_dept_codes$Frequency,
label = final_counts_dept_codes$Frequency, pos = 3, cex = 0.8, col = "blue")
dev.off()
toc()
list.of.packages <- c("readr", "tictoc", "lubridate")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
tic("everything runtime")
rm(list=ls())
setwd("~/P card reporting project")
# copy and paste the following command to the console: install.packages("readr")
# setwd("~/Documents/Random R/p card")
library(readr)
data <- read.csv("cta_historical.csv")
data$FIN.TRANSACTION.AMOUNT <- parse_number(data$FIN.TRANSACTION.AMOUNT)
data$ACC.LAST.NAME <- as.character(data$ACC.LAST.NAME)
data$FIN.POSTING.DATE <- as.Date(data$FIN.POSTING.DATE, format = "%m/%d/%Y")
data$FIN.TRANSACTION.DATE <- as.Date(data$FIN.TRANSACTION.DATE, format = "%m/%d/%Y")
data_ytd_18 <- subset(data, data$FIN.POSTING.DATE >= as.Date('2017-09-01') &
data$FIN.POSTING.DATE <= as.Date('2018-06-30'))  ## SUCCESS!!
sum_ytd_18 <- c()
( lnames <- c(unique(data_ytd_18$ACC.LAST.NAME)) )
for (x in lnames){
new_data <- subset(data_ytd_18, data_ytd_18$ACC.LAST.NAME == x)
new_sum <- sum(new_data$FIN.TRANSACTION.AMOUNT)
sum_ytd_18[x] <- as.numeric(new_sum)
}
(sum_ytd_18 <- as.data.frame(sum_ytd_18))
data_ytd_17 <- subset(data, data$FIN.POSTING.DATE >= as.Date('2016-09-01') &
data$FIN.POSTING.DATE <= as.Date('2017-06-30'))  ## SUCCESS!!
sum_ytd_17 <- c()
( lnames <- c(unique(data_ytd_17$ACC.LAST.NAME)) )
for (x in lnames){
new_data <- subset(data_ytd_17, data_ytd_17$ACC.LAST.NAME == x)
new_sum <- sum(new_data$FIN.TRANSACTION.AMOUNT)
sum_ytd_17[x] <- as.numeric(new_sum)
}
(sum_ytd_17 <- as.data.frame(sum_ytd_17))
together <- data.frame(FY18 = numeric(), FY17 = numeric())
together_names <- c( c(data_ytd_18$ACC.LAST.NAME), c(data_ytd_17$ACC.LAST.NAME) )
(unique_together_names <- unique(together_names))
for (x in unique_together_names){
if (any(rownames(sum_ytd_18) == x)){
lnames_sum_18 <- sum_ytd_18[x,]
} else {
lnames_sum_18 <- 0
}
if (any(rownames(sum_ytd_17) == x)) {
lnames_sum_17 <- sum_ytd_17[x,]
} else {
lnames_sum_17 <- 0
}
together[x,] <- c(lnames_sum_18,lnames_sum_17)
}
png("ytd_comp/YTD_cta_Comparisons.png", width = 800, height = 600, units = 'px', res=100)
op <- par(mar=c(9,4,4,2))
ylim <- c(0, 1.3*max( max(together$FY18),max(together$FY17) ))
yoy_comparisons_plot <- barplot(t(together),names.arg = row.names(together),
horiz = FALSE,las=2, ylim = ylim, main = "YTD Comparisons for CTA (Up to July), FY17 vs FY18",
col=c("light blue","yellow"), beside = TRUE, legend = colnames(together))
rm(op)
#text(x = yoy_comparisons_plot, y = rbind((together$FY18), (together$FY17)),
#     srt = 25, label = rbind(t(together$FY18), t(together$FY17)), pos = 3, cex = 0.8, col = "blue")
dev.off()
write.csv(together, file = "ytd_comp/ytd_cta_comparisons_table.csv")
toc()
